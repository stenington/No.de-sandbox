var url = require('url');

exports.create = function create(){
  return function handler(req, res) {
    var reqUrl = url.parse(req.url);
    var moduleName = reqUrl.pathname.split("/", 2)[1];

    try {
      require.resolve("SERVED/" + moduleName); 
    }
    catch(err) {
      res.writeHead('404 Not Found', {'Content-Type': 'text/plain'});
      res.end("(>_<)\n");
      return;
    }

    if( reqUrl.pathname.split("/").length > 2 ){
      var module = require("SERVED/" + moduleName);
      module.handleRequest(req, res);
    }
    else {
      res.writeHead('200 OK', {'Content-Type': 'text/plain'});
      res.end("d(^_^)b\n");
    }
  };
};
